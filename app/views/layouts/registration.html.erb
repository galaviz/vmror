<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Verde Monarca">
    <meta name="keywords" content="">
    <meta name="author" content="Maurizio Calo">
    <link href="assets/img/favicon.png" rel="shortcut icon" >
    <title>Verde Monarca</title>
    <%= stylesheet_link_tag "bootstrap.min" %>
    <%= stylesheet_link_tag "style" %>
    <%= stylesheet_link_tag "responsive" %>
    <%= stylesheet_link_tag "animate.min" %>
    <%= stylesheet_link_tag "colorpickr" %>
    <%= stylesheet_link_tag "linecons" %>
    <%= stylesheet_link_tag "social-icons" %>
    <%= stylesheet_link_tag "font-awesome.min" %>
    <%= stylesheet_link_tag "axfont" %>
    <%= stylesheet_link_tag "formsStyle" %>
    <%= stylesheet_link_tag "formsResponsive" %>
    <%= stylesheet_link_tag "pickadate/classic" %>
    <%= stylesheet_link_tag "pickadate/classic.date" %>
    <%= stylesheet_link_tag "pickadate/classic.time" %>
    <%= stylesheet_link_tag "jquery.signaturepad" %>

    <!-- Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600' rel='stylesheet' type='text/css'>
    <!-- Web Fonts -->
    <link href='//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <%= javascript_include_tag "modernizr.custom" %>
  </head>

  <body data-spy="scroll" data-offset="0" data-target=".navbar">

    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <%=link_to image_tag("Logo_Verde_Monarca.png", :border => 0), {:action => "index", :controller => "main"}, :class => "navbar-brand smoothScroll"%>
        </div>

        <div class="navbar-collapse collapse">


          <!-- Sign In / Sign Up -->
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown"><a href="#signin" data-toggle="modal" data-target="#registration-modal"> MI PORTAL</a></li>
          </ul>
        </div><!--/nav-collapse -->
      </div><!-- /container -->
    </div><!-- /fixed-navbar -->


    <!-- Sign In / Sign Up Modal -->
    <div class="modal fade bs-modal-sm" id="registration-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <br>
          <div class="modal-header">
            Iniciar Sesi&oacute;n
          </div>
          <div class="modal-body">
            <div id="myTabContent" class="tab-content">
              <!-- Sign In Form -->
              <div class="tab-pane fade active in" id="signin">
                <form class="form-horizontal" action="<%=url_for controller: "main", action: "login"%>" method="post" id="frmSignin">
                  <fieldset>
                    <!-- Text input-->
                    <div class="control-group">
                      <label class="control-label" for="Email">Email:</label>
                      <div class="controls">
                        <input id="sign-in-mail" name="Email" class="form-control" type="text" placeholder="email" class="input-large" required="">
                      </div>
                    </div>

                    <!-- Password input-->
                    <div class="control-group">
                      <label class="control-label" for="passwordinput">Password:</label>
                      <div class="controls">
                        <input required="" id="passwordinput" name="passwordinput" class="form-control" type="password" placeholder="********" class="input-medium">
                      </div>
                    </div>

                    <!-- Multiple Checkboxes (inline) -->
<!--                    <div class="control-group">
                      <label class="control-label" for="rememberme"></label>
                      <div class="controls">
                        <label class="checkbox inline" for="rememberme-0">
                          <input type="checkbox" name="rememberme" id="rememberme-0" value="Remember me">
                          Recuerdame
                        </label>
                      </div>
                    </div>
 -->
                    <!-- Button -->
                    <div class="control-group">
                      <label class="control-label" for="signin"></label>
                      <div class="controls">
                        <button id="signin" name="signin" class="btn btn-theme btn-block">Iniciar Sesi√≥n</button>
                      </div>
                    </div>
                    
                    <div class="control-group" style="color:red;">
                      <center>
                        <label class="control-label" id="error-label"></label>
                      </center>
                    </div>

                  </fieldset>
                </form>
              </div><!-- /signin -->

            </div><!-- /tab-content -->
          </div><!-- /modal-body -->

          <div class="modal-footer">
            <center>
              <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </center>
          </div>
        </div><!-- /modal-content -->
      </div><!-- /modal-dialog -->
    </div><!-- /modal -->

    <div class="registration" id="registration-container">
      <div class="container">
        <div class="row text-center">
          <div class="container">
            <div class="row text-center">
              <%= yield%>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--Helper Modal-->
    <%= render(:partial => "shared/donde_lo_encuentro", :locals=> {:modalId=>"modal-residential-consumption-summary",:imageName=>"Energy_Bill_Examples/Residential/Residential_Energy_Consumption_Summary.jpg"}) %>
    <%= render(:partial => "shared/donde_lo_encuentro", :locals=> {:modalId=>"modal-residential-rpu",:imageName=>"Energy_Bill_Examples/Residential/Residential_RPU_Example.jpg"}) %>
    <%= render(:partial => "shared/donde_lo_encuentro", :locals=> {:modalId=>"modal-residential-fixed-charge",:imageName=>"Energy_Bill_Examples/Residential/Residential_Fixed_Charge_Example.jpg"}) %>
    <%= render(:partial => "shared/donde_lo_encuentro", :locals=> {:modalId=>"modal-residential-energy-subtotal",:imageName=>"Energy_Bill_Examples/Residential/Residential_Energy_Subtotal_Example.jpg"}) %>
    <%= render(:partial => "shared/donde_lo_encuentro", :locals=> {:modalId=>"modal-residential-tarifa",:imageName=>"Energy_Bill_Examples/Residential/Residential_Electricity_Rate_Example.jpg"}) %>
    <!--/Helper Modal-->

    <%= render(:partial => "shared/footer")%>

    <!-- jQuery  -->
    <%= javascript_include_tag "jquery.min" %>
    <%= javascript_include_tag "bootstrap.min" %>
    <%= javascript_include_tag "detectmobilebrowser" %>
    <%= javascript_include_tag "smoothscroll" %>
    <%= javascript_include_tag "bootstrapValidator.min" %>
    <%= javascript_include_tag "jquery.inview.min" %>
    <%= javascript_include_tag "jquery.easing.1.3" %>
    <%= javascript_include_tag "animations" %>
    <%= javascript_include_tag "jquery.formatter.min" %>
    <%= javascript_include_tag "jspdf" %>
    <%= javascript_include_tag "myFormatter" %>
    <%= javascript_include_tag "legacy" %>
    <%= javascript_include_tag "picker" %>
    <%= javascript_include_tag "picker.time" %>
    <%= javascript_include_tag "picker.date" %>
    <%= javascript_include_tag "vfs_fonts" %>
    <%= javascript_include_tag "verdemonarca" %>
    <%= javascript_include_tag "jquery.signaturepad.min" %>
    <%= javascript_include_tag "json2.min" %>

    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>

	<script>
		$(document).ready(function() {
			$(".nav li a").on("click",function(){
			$(".navbar-collapse").collapse("hide");
		})

		$( "#frmSignin" ).submit(function( event ) {
			event.preventDefault();
			var pRequestO = new Object();
			pRequestO.email=$("#sign-in-mail").val();
			pRequestO.passwordinput=$("#passwordinput").val();

			Ajax(pRequestO, "/main/login", function(pResponse){window.location = "/dashboard/monitoring"}, function(pResponse){$("#error-label").html(pResponse.messages);})

		});

		$( "#registration-form-user" ).submit(function( event ) {
			event.preventDefault();

			if (validateEmail($("#email").val())) {
				$("#email").css("border", "1px solid red");
				$("html, body").animate({
					scrollTop: $("#registration-form-user").offset().top - 100
				}, 500);
				return false;
			}

			$(".require").each(function(){
				if ($(this).val() == "" || $(this).val() == null) {
					$(this).css("border", "1px solid red");
					$("html, body").animate({
						scrollTop: $("#registration-form-user").offset().top - 100
					}, 500);
				}
				else{
					$(this).css("border", "1px solid transparent");
				}
			});

			if($("#email").val() != "" && $("#first-name").val() != "" && $("#last-name").val() != "" && $('[name="municipio"]').val() != null){
				var pRequestO = new Object();

				pRequestO.empresa= $('[name="empresa"]').val();
				pRequestO.nombre= $('[name="nombre"]').val();
				pRequestO.apellido= $('[name="apellido"]').val();
				pRequestO.email= $('[name="email"]').val();
				pRequestO.telefono= $('[name="telefono"]').val();
				pRequestO.celular= $('[name="celular"]').val();
				pRequestO.pais= $('[name="pais"]').val();
				pRequestO.estado= $('[name="estado"]').val();
				pRequestO.municipio= $('[name="municipio"]').val();
				pRequestO.calle= $('[name="calle"]').val();
				pRequestO.numero= $('[name="numero"]').val();
				pRequestO.colonia= $('[name="colonia"]').val();
				pRequestO.codigoPostal= $('[name="codigo-postal"]').val();
				Ajax(
					pRequestO,
					"/Registration/post_user_info",
					function(pResponse){
						window.location = pResponse.location
					},
					function(pResponse){
						$('[data-toggle="popover"]').popover({
							html : true,
							content: function() {
								return "<div style='color:red;'>" + pResponse.messages + "</div>";
							}
						});
						$('[data-toggle="popover"]').popover("show");
						$('html, body').animate({
							scrollTop: $("#registration-form-user").offset().top - 100
						}, 500);
				})
			}
		});

		$('[name="pais"]').on('change', function(){

		$('[name="estado"]').html("");
		$('[name="municipio"]').html("");
		var pRequestO = new Object();
		pRequestO.country = $(this).val();
		Ajax(pRequestO,"/states/get_states",function(pResponse){
		$.each(pResponse.state_list, function(i, state) {
		var st = '<option value="' + state.id + '">' + state.description + '</option>'
		$('[name="estado"]').append(st);
		})
		},function(pResponse){})

		});

		$('[name="estado"]').on('change', function(){

		$('[name="municipio"]').html("");
		var pRequestO = new Object();
		pRequestO.state = $(this).val();
		Ajax(pRequestO,"/locations/get_locations",function(pResponse){
		$.each(pResponse.location_list, function(i, location) {
		var lc = '<option value="' + location.id + '">' + location.description + '</option>'
		$('[name="municipio"]').append(lc);
		})
		},function(pResponse){})

		});

		});

		function validateEmail(email) {
		var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
		if( emailReg.test( email ) ) {
		return false;
		} else {
		return true;
		}
		}
	</script>
  </body>
</html>

